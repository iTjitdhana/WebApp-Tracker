<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ESP Tracker UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô -->
  <div class="position-absolute top-0 end-0 m-3">
    <div class="dropdown">
      <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
        ‚ò∞
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
  <li><a class="dropdown-item" href="logs.html">üìã Log ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a></li>
  <li><a class="dropdown-item" href="dashboard.html">üìä Dashboard</a></li>
  <li><a class="dropdown-item" href="workplan.html">üìù ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏¥‡∏ï</a></li>
</ul>

    </div>
  </div>

  <div class="container mt-5">
    <div class="mb-3">
      <select class="form-select w-auto" id="device-select" onchange="updateFromDropdown()">
        <option value="01">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1</option>
        <option value="02">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2</option>
        <option value="03">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3</option>
        <option value="04">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4</option>
        <option value="05">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 5</option>
        <option value="06">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 6</option>
        <option value="07">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 7</option>
        <option value="08">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 8</option>
        <option value="09">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 9</option>
        <option value="10">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 10</option>
        <option value="11">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 11</option>
        <option value="12">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 12</option>
        <option value="13">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 13</option>
        <option value="14">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 14</option>
        <option value="15">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 15</option>
        <option value="16">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 16</option>
        <option value="17">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 17</option>
        <option value="18">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 18</option>
        <option value="19">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 19</option>
        <option value="20">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 20</option>
      </select>
    </div>

    <div class="row align-items-center bg-white rounded p-4 shadow mx-1">
      <div class="col-md-6 text-center">
        <div class="job-title hidden" id="job-title">
          ‡∏ã‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏ï‡∏∏‡πã‡∏ô 170 ‡∏Å‡∏£‡∏±‡∏° (1‡πÅ‡∏û‡πá‡∏Ñ /1‡∏à‡∏≤‡∏ô )
        </div>
        <div class="number-display" id="num-display">01</div>
        <div class="process-name hidden" id="process-name">
          1 | ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
        </div>
        <div class="status-log bg-light" id="status-log">
          ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        </div>
      </div>
      <div class="col-md-6 d-flex flex-column gap-3">
        <button class="btn btn-danger btn-lg" onclick="sendToLocal(false)">
          ‚õî ‡∏´‡∏¢‡∏∏‡∏î‡∏á‡∏≤‡∏ô
        </button>
        <button class="btn btn-success btn-lg" onclick="sendToLocal(true)">
          ‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô
        </button>
        <div class="d-flex flex-column gap-2">
          <button class="btn btn-warning" onclick="changeNumber(1)">‚ñ≤</button>
          <button class="btn btn-warning" onclick="changeNumber(-1)">‚ñº</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let number = 1;
    const processMap = {
      1: "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå",
      2: "‡∏ä‡∏±‡πà‡∏á‡∏ô‡πâ‡∏≥ ‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∏‡∏á ‡πÉ‡∏™‡πà‡∏ã‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 1",
      3: "‡∏ï‡∏∏‡πã‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ, ‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏°‡πâ‡∏≠, ‡πÅ‡∏û‡πá‡∏Ñ ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 1",
      4: "‡∏ä‡∏±‡πà‡∏á‡∏ô‡πâ‡∏≥ ‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∏‡∏á ‡πÉ‡∏™‡πà‡∏ã‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 2",
      5: "‡∏ï‡∏∏‡πã‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ, ‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏°‡πâ‡∏≠, ‡πÅ‡∏û‡πá‡∏Ñ ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 2",
      6: "‡∏ä‡∏±‡πà‡∏á‡∏ô‡πâ‡∏≥ ‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∏‡∏á ‡πÉ‡∏™‡πà‡∏ã‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 3",
      7: "‡∏ï‡∏∏‡πã‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ, ‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏°‡πâ‡∏≠, ‡πÅ‡∏û‡πá‡∏Ñ ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 3",
      8: "‡∏ä‡∏±‡πà‡∏á‡∏ô‡πâ‡∏≥ ‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∏‡∏á ‡πÉ‡∏™‡πà‡∏ã‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 4",
      9: "‡∏ï‡∏∏‡πã‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ, ‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏°‡πâ‡∏≠, ‡πÅ‡∏û‡πá‡∏Ñ ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 4",
      10: "‡∏ä‡∏±‡πà‡∏á‡∏ô‡πâ‡∏≥ ‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∏‡∏á ‡πÉ‡∏™‡πà‡∏ã‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 5",
      11: "‡∏ï‡∏∏‡πã‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ, ‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏°‡πâ‡∏≠, ‡πÅ‡∏û‡πá‡∏Ñ ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 5",
      12: "‡∏•‡πâ‡∏≤‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå"
    };

    function changeNumber(step) {
      number += step;
      if (number > 12) number = 1;
      if (number < 1) number = 12;
      updateDisplay();
    }

    function updateDisplay() {
      document.getElementById("num-display").textContent =
        number.toString().padStart(2, '0');

      const selected = document.getElementById("device-select").value;
      const processName = document.getElementById("process-name");
      const jobTitle = document.getElementById("job-title");

      if (selected === "10") {
        processName.classList.remove("hidden");
        jobTitle.classList.remove("hidden");
        processName.textContent = number + " | " + (processMap[number] || "");
        jobTitle.textContent = "‡∏ã‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏ï‡∏∏‡πã‡∏ô 170 ‡∏Å‡∏£‡∏±‡∏° (1‡πÅ‡∏û‡πá‡∏Ñ /1‡∏à‡∏≤‡∏ô )";
      } else {
        processName.classList.add("hidden");
        jobTitle.classList.add("hidden");
      }
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô select
    function updateFromDropdown() {
      number = 1;
      updateDisplay();
    }

    function getCurrentTime() {
      const now = new Date();
      return now.toLocaleTimeString('th-TH', { hour12: false });
    }

    function sendToLocal(isStart) {
      const deviceId = `ESP-${document.getElementById("device-select").value}`;
      const timestamp = getCurrentTime();
      const statusLog = document.getElementById("status-log");

      statusLog.className = "status-log bg-light";
      statusLog.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á (${isStart ? "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô" : "‡∏´‡∏¢‡∏∏‡∏î‡∏á‡∏≤‡∏ô"})...`;

      fetch("save.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `number=${number}&timestamp=${timestamp}&sheetName=Data&deviceId=${deviceId}&status=${isStart ? "start" : "stop"}`
      })
      .then(res => res.text())
      .then(() => {
        statusLog.classList.add(isStart ? "status-success" : "status-fail");
        statusLog.textContent = isStart ? "‚úÖ Start ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß" : "‚õî Stop ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß";
      })
      .catch(err => {
        statusLog.className = "status-log status-fail";
        statusLog.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        console.error(err);
      });
    }

    updateDisplay();
  </script>

  <!-- ‡πÇ‡∏´‡∏•‡∏î Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

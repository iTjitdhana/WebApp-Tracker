<!DOCTYPE html>
<html lang="th">

<head>
      <meta charset="UTF-8" />
      <title>Dashboard | ESP Tracker</title>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
      <link rel="stylesheet" href="dashboard.css" />
</head>

<body>
      <div class="container py-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                  <h2 class="fw-bold">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h2>

                  <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                              data-bs-toggle="dropdown">
                              ‚ò∞ ‡πÄ‡∏°‡∏ô‡∏π
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                              <li><a class="dropdown-item" href="index.html">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
                              <li><a class="dropdown-item" href="logs.html">üìã Log ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a></li>
                              <li><a class="dropdown-item" href="dashboard.html">üìä Dashboard</a></li>
                              <li><a class="dropdown-item" href="workplan.html">üìù ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏¥‡∏ï</a></li>
                        </ul>

                  </div>
            </div>

            <div class="row" id="card-container">
                  <div class="col-12 text-center text-muted">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
            </div>
      </div>

      <script>
            const deviceNameMap = {
                  "ESP-01": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1",
                  "ESP-02": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2",
                  "ESP-03": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3",
                  "ESP-04": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4",
                  "ESP-05": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 5",
                  "ESP-06": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 6",
                  "ESP-07": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 7",
                  "ESP-08": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 8",
                  "ESP-09": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 9",
                  "ESP-10": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 10",
                  "ESP-11": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 11",
                  "ESP-12": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 12",
                  "ESP-13": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 13",
                  "ESP-14": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 14",
                  "ESP-15": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 15",
                  "ESP-16": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 16",
                  "ESP-17": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 17",
                  "ESP-18": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 18",
                  "ESP-19": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 19",
                  "ESP-20": "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà 20"
            };

            fetch("get_data.php")
                  .then(res => res.json())
                  .then(data => {
                        const latestByDevice = {};

                        // ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ deviceId
                        data.forEach(entry => {
                              const id = entry.deviceId;
                              if (!latestByDevice[id] || new Date(entry.timestamp) > new Date(latestByDevice[id].timestamp)) {
                                    latestByDevice[id] = entry;
                              }
                        });

                        const container = document.getElementById("card-container");
                        container.innerHTML = "";

                        Object.keys(latestByDevice).sort().forEach(deviceId => {
                              const { number, timestamp, status } = latestByDevice[deviceId];
                              const card = document.createElement("div");
                              card.className = `col-md-4 mb-4`;

                              card.innerHTML = `
            <div class="card shadow card-status ${status === 'start' ? 'status-start' : 'status-stop'}">
              <div class="card-body">
                <h5 class="card-title">${deviceNameMap[deviceId] || deviceId}</h5>
                <p class="card-text">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô: <strong>${number}</strong></p>
                <p class="card-text">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <strong>${status === "start" ? "üü¢ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà" : "üî¥ ‡∏´‡∏¢‡∏∏‡∏î"}</strong></p>
                <p class="card-text"><small class="text-muted">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${timestamp}</small></p>
              </div>
            </div>
          `;
                              container.appendChild(card);
                        });
                  })
                  .catch(err => {
                        document.getElementById("card-container").innerHTML = `<div class="alert alert-danger">‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>`;
                        console.error(err);
                  });
      </script>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>